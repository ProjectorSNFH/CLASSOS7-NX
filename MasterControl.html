<!DOCTYPE html>
<html>

<head>
    <title>MASTER CONTROL</title>
    <style>
        body {
            background: black;
            color: #00ff00;
            font-family: 'Courier New', Courier, monospace;
            padding: 20px;
        }

        input {
            background: black;
            border: none;
            color: #00ff00;
            font-family: inherit;
            outline: none;
            width: 80%;
        }

        .output {
            white-space: pre-wrap;
            margin-bottom: 10px;
        }
    </style>
</head>

<body>
    <div class="output" id="output">
        Master Control v0.1
        ----------------------------------
        ENTER MASTER PASSWORD TO INITIALIZE...
    </div>
    <span>> </span><input type="text" id="consoleInput" autofocus>

    <script>
        const input = document.getElementById('consoleInput');
        const output = document.getElementById('output');
        let masterPassword = "";
        let isAuthorized = false;

        // 서버와 같은 도메인이므로 경로만 적어주면 됩니다.
        const ADMIN_API_URL = "/admin/master-control";

        input.addEventListener('keypress', async (e) => {
            if (e.key === 'Enter') {
                const val = input.value;
                input.value = "";

                try {
                    const res = await fetch(ADMIN_API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            password: isAuthorized ? masterPassword : val,
                            command: isAuthorized ? val : ""
                        })
                    });

                    const text = await res.text();

                    if (!isAuthorized) {
                        if (text.includes("READY")) {
                            masterPassword = val;
                            isAuthorized = true;
                        }
                        output.innerText += "\n" + text;
                    } else {
                        output.innerText += "\n> " + val + "\n" + text;
                    }
                } catch (err) {
                    output.innerText += "\nERROR: SERVER UNREACHABLE\n";
                }
                window.scrollTo(0, document.body.scrollHeight);
            }
        });
    </script>
</body>

</html>